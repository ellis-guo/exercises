# 智能健身计划生成系统 - 项目总结 v7.27.3

## 项目核心任务
开发一个基于用户目标肌群与动作模板，自动推荐每日训练动作组合的智能健身计划系统。核心目标是为每天生成5个高质量动作组合，覆盖用户目标肌群，控制结构重复，优化训练效果，并支持个性化约束。

## 系统架构概览

### 1. 用户输入层

#### 1.1 训练天数选择（1-7天）
- 基于`trainingTemplates.json`的科学训练分化
- 1天：全身训练（Full Body）
- 2天：上下肢分化（Upper/Lower Split）
- 3天：推拉腿分化（Push/Pull/Legs）
- 4天：推拉循环（Push/Pull x2）
- 5天：传统分化（Bro Split）
- 6天：推拉腿循环（Push/Pull/Legs x2）
- 7天：推拉腿循环+休息（Push/Pull/Legs x2 + Rest）

#### 1.2 肌群偏好系数设置
- 基于`preferenceMapping.json`的六大肌群分类
- 可调整肌群：chest, back, shoulder, arm, leg, core
- 系数范围：0.1-10.0（默认1.0）
- 系数直接影响静态评分计算

#### 1.3 排除动作设置
- 支持按动作ID（pk）精确排除
- 系统自动显示被排除的动作名称
- 排除的动作不参与任何计算

### 2. 数据结构层

#### 2.1 动作数据库（strength.json）
- 340个专业训练动作
- 详细的主要肌群（primaryMuscles）标注
- 完整的次要肌群（secondaryMuscles）标注
- 使用EN DASH（–）分隔动作名称和器械类型

#### 2.2 分类体系（classification文件夹）

**映射文件：**
- `categoryMapping.json`：动作ID与训练肌群的映射关系
- `preferenceMapping.json`：用户偏好大类到具体肌群的映射
- `trainingTemplates.json`：不同训练天数的科学模板

**六维分类文件：**
- `type1_isMajor.json`：大肌群/小肌群分类
- `type2_isCompound.json`：复合动作/孤立动作分类
- `type3_isSingle.json`：单侧/双侧动作分类
- `type4_isMachine.json`：器械/自由重量分类
- `type5_isCommon.json`：常用/非常用动作分类
- `type6_movementFamily.json`：动作族谱（50+个动作族）

#### 2.3 配置文件（config.json）
```json
{
  "algorithm_params": {
    "exercises_per_day": 5,
    "top_candidates_for_optimization": 20
  },
  "scoring_weights": {
    "primary_muscle": { "base_score": 3.0 },
    "secondary_muscle": { "base_score": 2.0 },
    "common_exercise_bonus": { "score": 2.0 }
  },
  "position_scores": { ... },
  "diversity_rules": { ... }
}
```

### 3. 评分系统层（三层结构）

#### 3.1 静态评分（与位置无关）
- **主肌群得分**：3.0 ÷ 肌群数量 × 用户偏好系数
- **次肌群得分**：2.0 ÷ 肌群数量 × 用户偏好系数
- **常用动作加分**：+2.0（基于type5_isCommon）
- **分摊机制**：防止多肌群动作得分过高

#### 3.2 动态评分第一层（位置相关）
| 动作类型 | 位置1 | 位置2 | 位置3 | 位置4 | 位置5 |
|---------|-------|-------|-------|-------|-------|
| 大肌群动作 | +8 | +5 | 0 | 0 | 0 |
| 小肌群动作 | 0 | 0 | 0 | +5 | +8 |
| 复合动作 | +8 | +5 | 0 | 0 | 0 |
| 孤立动作 | 0 | 0 | 0 | +5 | +8 |
| 自由重量 | +3 | +2 | 0 | 0 | 0 |
| 器械动作 | 0 | 0 | 0 | +2 | +3 |

#### 3.3 动态评分第二层（多样性平衡）
- **平衡阈值**：3个动作
- **超过阈值惩罚**：-3分
- **应用维度**：
  - 双侧/单侧平衡
  - 复合/孤立平衡
  - 器械/自由平衡

#### 3.4 惩罚机制
- **同族动作惩罚**：-10分（避免动作模式重复）
- **全周重复惩罚**：-8分（确保周计划多样性）
- **同肌群重复**：-1分/重复（基于categoryMapping）

### 4. 算法实现层

#### 4.1 结构增强型贪心算法（已实现）
```python
核心流程：
1. 加载训练模板（根据训练天数）
2. 筛选当日可训练动作
3. 过滤用户排除列表
4. 计算所有动作静态分数
5. 贪心选择5个动作：
   for position in range(5):
       - 计算剩余动作的动态分数
       - 选择总分（静态+动态）最高的动作
       - 更新已选特征（族、类型计数等）
       - 加入选中列表
6. 生成训练计划报告
```

#### 4.2 算法特性
- **时间复杂度**：O(n×m)，n为候选动作数，m=5
- **空间复杂度**：O(n)
- **实时性能**：毫秒级响应
- **局部最优**：贪心策略
- **全周去重**：global_selected_ids追踪

### 5. 技术实现亮点

#### 5.1 编码处理
- 强制UTF-8编码，完美支持EN DASH
- Windows控制台兼容（chcp 65001）
- 安全打印函数处理编码异常
- 跨平台兼容性保证

#### 5.2 模块化设计
- 清晰的类结构（GreedyWorkoutSelector）
- 配置与代码分离
- 数据文件独立管理
- 易于扩展的规则引擎

#### 5.3 用户体验
- 详细的分数分解（静态/动态/总分）
- 清晰的训练计划输出格式
- 当前配置的透明展示
- 完整的评分机制说明

### 6. 输出示例
```
Day 1: Chest & Triceps
Target Muscles: chest, shoulder, tricep
Daily Total Score: 67.45
------------------------------------------------------------

Position 1. [9] Bench Press – Barbell
   Static Score: 3.0 | Dynamic Score: 19.0 | Total: 22.0
   Primary Muscles: chest, shoulder - front
   Secondary Muscles: tricep

Position 2. [37] Shoulder Press – Dumbbell
   Static Score: 3.0 | Dynamic Score: 10.0 | Total: 13.0
   Primary Muscles: shoulder - front
   Secondary Muscles: shoulder - side, tricep
...
```

### 7. 项目成果总结

#### 7.1 已完成功能
- ✅ 完整的1-7天训练计划生成
- ✅ 六大肌群偏好系统
- ✅ 三层评分机制（静态+动态两层）
- ✅ 全周动作去重机制
- ✅ 六维度平衡控制
- ✅ 灵活的排除机制
- ✅ 详细的输出展示
- ✅ 完善的编码处理

#### 7.2 数据完整性
- 340个专业训练动作
- 6个分类维度
- 50+个动作族
- 完整的肌群映射体系

#### 7.3 算法优势
- 科学的位置安排（大→小，复合→孤立，自由→器械）
- 智能的多样性控制
- 高效的贪心策略
- 灵活的用户定制

### 8. 未来发展方向

#### 8.1 算法优化
- 实现组合优化算法（Top 20枚举）
- 加入机器学习个性化推荐
- 疲劳度和恢复时间建模
- 渐进超负荷追踪系统

#### 8.2 功能扩展
- 训练量（Volume）计算
- RPE（自觉疲劳度）集成
- 训练进度追踪
- 营养建议联动
- 移动端API开发

#### 8.3 数据增强
- 动作演示视频链接
- 难度等级细分（初级/中级/高级）
- 器械可替代性标注
- 肌群激活程度热图
- 常见错误提示

### 9. 技术栈
- **语言**：Python 3.x
- **编码**：UTF-8
- **数据格式**：JSON
- **算法**：贪心算法
- **设计模式**：策略模式、配置驱动

### 10. 项目状态
**Production Ready** - 系统已具备完整的核心功能，可以生成科学、平衡、个性化的训练计划。代码质量高，扩展性强，文档完善，为未来的功能迭代和商业化应用打下了坚实基础。

---
*最后更新：2024年7月27日 v7.27.3*
*主要更新：修正自由/器械位置得分，完善算法实现*